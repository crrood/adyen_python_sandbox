<HTML>
	<head>
		<link rel="stylesheet" type="text/css" href="styles/style.css"/>
	</head>
	<body>
		<form class="client-form" id="infoForm">
			<div class="inputHolder">amount: <input type="text" id="value" name="value" value="199"/><br></div>
			<div class="inputHolder">currency: <input type="text" id="currency" name="currency" value="USD"/><br></div>
			<div class="inputHolder">number: <input type="text" id="number" name="number" value="5212345678901234"/><br></div>
			<div class="inputHolder">expiryMonth: <input type="text" id="expiryMonth" name="expiryMonth" value="10"/><br></div>
			<div class="inputHolder">expiryYear: <input type="text" id="expiryYear" name="expiryYear" value="2020"/><br></div>
			<div class="inputHolder">cvc: <input type="text" id="cvc" name="cvc" value="737"/><br></div>
			<div class="inputHolder">holderName: <input type="text" id="holderName" name="holderName" value="Test Shopper"/><br></div>
			<div class="inputHolder">reference: <input type="text" id="reference" name="reference" value="Localhost 3DS 1"/><br></div>
			<input type="hidden" name="endpoint" value="threeds1"/>
			<input type="button" class="submitBtn center" id="checkoutBtn" value="Send request"/>
		</form>
		<div id="constructedFormHolder"/>
	</body>
</HTML>

<script type="module">

import * as common from "./scripts/common.js";

// Sends form params to server
document.querySelector("#checkoutBtn").addEventListener("click", () => {
	common.AJAXPost(common.buildFormURL({"userAgent": navigator.userAgent}), checkoutCallback);
});

// Redirects user to result URL via POST call
function checkoutCallback(data) {
	// parse response
	data = JSON.parse(data);
	let issuerURL = data.redirect.url;
	let redirectData = data.redirect.data;

	// because the redirect has to be done as a POST...
	// create an HTML form and redirect the user
	let form = document.createElement("form");
	form.setAttribute("method", "POST");
	form.setAttribute("action", issuerURL);

	// iteract through redirect params
	for (let param in redirectData) {
		let input = document.createElement("input");
		input.setAttribute("type", "hidden");
		input.setAttribute("name", param);
		input.setAttribute("value", redirectData[param]);

		form.appendChild(input);
	}

	document.querySelector("#constructedFormHolder").appendChild(form);
	form.submit();
}

</script>